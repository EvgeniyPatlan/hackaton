# Analytics Service для системи "Безбар'єрний доступ України"

Сервіс аналітики для збору, обробки та візуалізації даних про використання системи "Безбар'єрний доступ України".

## Функціональність

- Збір статистики використання системи
- Аналіз даних про доступність об'єктів
- Відстеження активності користувачів
- Геопросторова аналітика по регіонах та містах
- Формування звітів та візуалізація даних
- Рейтинги популярності локацій

## Технічний стек

- NestJS (TypeScript)
- Prisma ORM
- Postgres з PostGIS
- Valkey (Redis-сумісний кеш)
- Docker
- Swagger для API документації

## Структура проекту

```
analytics-service/
├── Dockerfile         # Конфігурація Docker
├── package.json       # Залежності проекту
├── prisma/            # ORM та схема бази даних
│   └── schema.prisma  # Схема бази даних
└── src/               # Вихідний код сервісу
    ├── main.ts        # Вхідна точка додатку
    ├── app.module.ts  # Головний модуль
    ├── prisma/        # Модуль для роботи з БД
    ├── redis/         # Модуль для роботи з кешем
    ├── health/        # Модуль перевірки стану
    └── analytics/     # Основна логіка аналітики
        ├── events/    # Збір подій та метрик
        ├── reports/   # Звіти та аналітика
        ├── dashboards/ # Дашборди для візуалізації
        ├── location-analytics/ # Аналітика локацій
        ├── user-analytics/    # Аналітика користувачів
        └── geo-analytics/     # Геопросторова аналітика
```

## API Endpoints

Сервіс надає наступні API ендпоінти:

### Основна аналітика

- `GET /api/v1/analytics/overview` - Загальний огляд системи
- `GET /api/v1/analytics/realtime` - Поточні метрики в реальному часі
- `GET /api/v1/analytics/health-check` - Перевірка стану сервісу

### Події

- `POST /api/v1/events` - Збереження нової події
- `GET /api/v1/events` - Отримання подій з фільтрацією
- `GET /api/v1/events/statistics/:eventType` - Статистика для конкретного типу подій

### Аналітика локацій

- `GET /api/v1/location-analytics/top` - Найпопулярніші локації
- `GET /api/v1/location-analytics/:locationId` - Аналітика для конкретної локації
- `POST /api/v1/location-analytics/:locationId` - Оновлення статистики локації
- `GET /api/v1/location-analytics/total/count` - Загальна кількість локацій

### Аналітика користувачів

- `GET /api/v1/user-analytics/active` - Найактивніші користувачі
- `GET /api/v1/user-analytics/active-count` - Кількість активних користувачів за період
- `GET /api/v1/user-analytics/total` - Загальна кількість користувачів
- `GET /api/v1/user-analytics/:userId` - Аналітика для конкретного користувача
- `POST /api/v1/user-analytics/:userId` - Оновлення статистики користувача

### Геопросторова аналітика

- `GET /api/v1/geo-analytics/regions/top` - Топ регіонів за кількістю локацій
- `GET /api/v1/geo-analytics/cities/top` - Топ міст за кількістю локацій
- `GET /api/v1/geo-analytics/regions/:regionName` - Статистика для конкретного регіону
- `GET /api/v1/geo-analytics/accessibility/by-region` - Статистика доступності по регіонах
- `GET /api/v1/geo-analytics/trends/regional` - Аналіз регіональних трендів

## Інтеграція з іншими сервісами

Сервіс аналітики інтегрується з іншими компонентами системи:

- **Auth Service** - для авторизації запитів
- **Location Service** - для отримання даних про локації
- **User Service** - для отримання даних про користувачів
- **File Service** - для експорту звітів
- **Frontend** - для відображення аналітичних дашбордів

## Запуск сервісу

### Локальний розробницький запуск

```bash
# Встановлення залежностей
npm install

# Генерація Prisma клієнта
npx prisma generate

# Запуск в режимі розробки
npm run start:dev
```

### Запуск у складі всієї системи

```bash
# З кореневої папки проекту
./dev-start.sh
```

## Документація API

Документація API доступна за адресою `/api` після запуску сервісу.

## Автоматичні задачі (Cron jobs)

Сервіс включає такі заплановані задачі:

- Щоденна агрегація метрик (3:00)
- Щотижнева генерація звітів (неділя, 4:00)
- Щомісячна генерація звітів (1-ше число, 5:00)
